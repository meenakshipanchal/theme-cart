<!doctype html>
<html class="js" lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#00584b">
    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    {%- unless settings.type_body_font.system? and settings.type_header_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}
    <!-- ADD THESE TWO LINES: -->
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="dns-prefetch" href="https://cdn.shopify.com">

    <title>
      {{- page_title -}}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>
    {%- if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% endif -%}
    {%- render 'meta-tags' -%}

    {%- comment -%} Anti-DevTools: blocks inspect, F12, Ctrl+Shift+I/J/C, Ctrl+U, right-click, text selection, drag. Only in production. {%- endcomment -%}
    {%- unless request.design_mode -%}
      <script src="{{ 'anti-devtools.js' | asset_url }}" defer="defer"></script>
    {%- endunless -%}
    <script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'search-form.js' | asset_url }}" defer="defer"></script>

    {%- if settings.animations_reveal_on_scroll -%}
      <script src="{{ 'animations.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {{ content_for_header }}

    {% style %}
      {% for scheme in settings.color_schemes -%}
        {% assign scheme_classes = scheme_classes | append: ', .color-' | append: scheme.id %}
        {% if forloop.index == 1 -%}
          :root,
        {%- endif %}
        .color-{{ scheme.id }} {
          --color-background: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        {% if scheme.settings.background_gradient != empty %}
          --gradient-background: {{ scheme.settings.background_gradient }};
        {% else %}
          --gradient-background: {{ scheme.settings.background }};
        {% endif %}

        {% liquid
          assign background_color = scheme.settings.background
          assign background_color_brightness = background_color | color_brightness
          if background_color_brightness <= 26
            assign background_color_contrast = background_color | color_lighten: 50
          elsif background_color_brightness <= 65
            assign background_color_contrast = background_color | color_lighten: 5
          else
            assign background_color_contrast = background_color | color_darken: 25
          endif
        %}

        --color-foreground: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --color-background-contrast: {{ background_color_contrast.red }},{{ background_color_contrast.green }},{{ background_color_contrast.blue }};
        --color-shadow: {{ scheme.settings.shadow.red }},{{ scheme.settings.shadow.green }},{{ scheme.settings.shadow.blue }};
        --color-button: {{ scheme.settings.button.red }},{{ scheme.settings.button.green }},{{ scheme.settings.button.blue }};
        --color-button-text: {{ scheme.settings.button_label.red }},{{ scheme.settings.button_label.green }},{{ scheme.settings.button_label.blue }};
        --color-secondary-button: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        --color-secondary-button-text: {{ scheme.settings.secondary_button_label.red }},{{ scheme.settings.secondary_button_label.green }},{{ scheme.settings.secondary_button_label.blue }};
        --color-link: {{ scheme.settings.secondary_button_label.red }},{{ scheme.settings.secondary_button_label.green }},{{ scheme.settings.secondary_button_label.blue }};
        --color-badge-foreground: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --color-badge-background: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        --color-badge-border: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --payment-terms-background-color: rgb({{ scheme.settings.background.rgb }});
      }
      {% endfor %}

      {{ scheme_classes | prepend: 'body' }} {
        color: rgba(var(--color-foreground), 0.75);
        background-color: rgb(var(--color-background));
      }

      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }

      html {
        box-sizing: border-box;
        font-size: calc(var(--font-body-scale) * 62.5%);
        height: 100%;
      }

      body {
        display: grid;
        grid-template-rows: auto auto 1fr auto;
        grid-template-columns: 100%;
        min-height: 100%;
        margin: 0;
        padding:0px !important;
        font-size: 1.35rem;
        letter-spacing: 0.06rem;
        line-height: calc(1 + 0.45 / var(--font-body-scale));
        font-family: var(--font-body-family);
        font-style: var(--font-body-style);
        font-weight: var(--font-body-weight);
      }

      @media screen and (min-width: 750px) {
        body {
          font-size: 1.45rem;
        }
      }
      div.css-8vbgga { z-index: 98 !important; }
      div#POPStar { z-index: 97 !important; }
      div.pop-star #pop-club-quick-buy3 span { font-size: 1.4rem; }
      div.pop-star #pop-club-quick-buy3 span span.reward_name { font-weight: 600; }
      div.pop-star #pop-club-quick-buy3 span img { max-width: 24px; height: auto; }
      div.pop-star button#pop-club-quick-buy3 { padding: 5px 7px; min-height: auto; }
    {% endstyle %}

    <!-- CRITICAL CSS INLINED FOR LCP OPTIMIZATION -->
    <style>
      /* Critical Above-the-Fold CSS from base-style.css & theme.css */
      :root {
        --page-width: 140rem;
        --font-body-family: Figtree, sans-serif;
        --font-heading-family: "Roboto Slab", serif;
        --theme-primy-color: #00584b;
      }
      .page-width { max-width: var(--page-width); margin: 0 auto; padding: 0 1.5rem; }
      .hidden { display: none !important; }
      .visually-hidden { position: absolute !important; overflow: hidden; width: 1px; height: 1px; margin: -1px; padding: 0; border: 0; clip: rect(0 0 0 0); word-wrap: normal !important; }
      .isolate { position: relative; z-index: 0; }

      /* =============================================
         HEADER CRITICAL STYLES - Match base-style.css
         ============================================= */
      .header {
        display: grid;
        grid-template-areas: 'left-icons heading icons';
        grid-template-columns: 1fr 2fr 1fr;
        align-items: center;
      }
      .header__heading { margin: 0; line-height: 0; grid-area: heading; justify-self: center; }
      .header__heading-link { display: inline-block; padding: 0.75rem; text-decoration: none; word-break: break-word; line-height: 0; grid-area: heading; justify-self: center; }
      .header__heading-logo { height: auto; max-width: 100%; }
      .header__heading-logo-wrapper { width: 100%; display: inline-block; }

      /* Header icons (search, account, cart) */
      .header__icons { display: flex; grid-area: icons; justify-self: end; padding-right: 0.8rem; }
      .header__icon:not(.header__icon--summary), .header__icon span { display: flex; align-items: center; justify-content: center; }
      .header__icon { color: rgb(var(--color-foreground)); height: 4.4rem; width: 4.4rem; padding: 0; }
      .header__icon span { height: 100%; }
      .header__icon .icon { height: 2rem; width: 2rem; fill: none; vertical-align: middle; }
      .header__icon--cart { position: relative; margin-right: -1.2rem; }
      .header__search { display: inline-flex; line-height: 0; }

      /* Inline menu - HIDDEN by default (mobile), shown on desktop */
      .header__inline-menu { display: none; margin-left: -1.2rem; grid-area: navigation; }

      /* Header drawer (hamburger) */
      header-drawer { justify-self: start; margin-left: -1.2rem; }
      .menu-drawer-container { display: flex; }

      /* Hamburger/close icon states - match base-style.css */
      .header__icon--menu .icon { display: block; position: absolute; opacity: 1; transform: scale(1); }
      details:not([open]) > .header__icon--menu .icon-close,
      details[open] > .header__icon--menu .icon-hamburger { visibility: hidden; opacity: 0; transform: scale(0.8); }

      /* =============================================
         ANNOUNCEMENT BAR - Prevent slide stacking
         ============================================= */
      .utility-bar .slider--everywhere {
        flex-wrap: nowrap;
        overflow: hidden;
      }
      .utility-bar .slider--everywhere .slider__slide:not(:first-child) {
        display: none;
      }
      .announcement-bar-slider .slider-button { opacity: 0; width: 0; overflow: hidden; }
      .announcement-bar .slider-button--prev,
      .announcement-bar .slider-button--next { opacity: 0; width: 0; }
      .announcement-bar-slider .svg-wrapper { opacity: 0; }

      /* =============================================
         SLIDESHOW - Hide controls before CSS loads
         ============================================= */
      .slideshow { position: relative; }
      .banner__media { display: block; width: 100%; }
      .media { display: block; }
      .slideshow__controls { position: absolute; opacity: 0; pointer-events: none; }
      .slider-button { opacity: 0; }
      .slider-button--prev, .slider-button--next { opacity: 0; }
      .only-arrow .slider-button { opacity: 0; }

      /* =============================================
         DRAWERS & OVERLAYS - Hidden until activated
         ============================================= */
      .menu-drawer { visibility: hidden; transform: translateX(-100%); }
      .drawer { visibility: hidden; }
      cart-drawer:not(.active) { visibility: hidden; }

      /* =============================================
         SVG ICONS - Hide raw icons before styling
         ============================================= */
      svg.icon-arrow, svg.icon-caret { opacity: 0; }

      /* =============================================
         RESPONSIVE HIDE/SHOW CLASSES (from base-style.css)
         ============================================= */
      @media screen and (max-width: 749px) {
        .small-hide { display: none !important; }
      }
      @media screen and (min-width: 750px) {
        .page-width { padding: 0 3rem; }
      }
      @media screen and (min-width: 750px) and (max-width: 989px) {
        .medium-hide { display: none !important; }
      }
      @media screen and (min-width: 990px) {
        .large-up-hide { display: none !important; }
        .header__inline-menu { display: block; }
      }
      @media screen and (min-width: 1200px) {
        .page-width { padding: 0 5rem; }
      }
    </style>

    <!-- Load full stylesheets asynchronously after critical render -->
    <link
      rel="preload"
      href="{{ 'base-style.css' | asset_url }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    >
    <link rel="preload" href="{{ 'theme.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
      {{ 'base-style.css' | asset_url | stylesheet_tag }}
      {{ 'theme.css' | asset_url | stylesheet_tag }}
    </noscript>
    <link rel="stylesheet" href="{{ 'component-cart-items.css' | asset_url }}" media="print" onload="this.media='all'">

    {%- if settings.cart_type == 'drawer' or settings.cart_type == 'notification' -%}
      {{ 'custom-cart-drawer.css' | asset_url | stylesheet_tag }}
      {{ 'component-cart.css' | asset_url | stylesheet_tag }}
      {{ 'component-totals.css' | asset_url | stylesheet_tag }}
      {{ 'component-price.css' | asset_url | stylesheet_tag }}
      {{ 'component-discounts.css' | asset_url | stylesheet_tag }}
    {%- endif -%}

    {%- unless settings.type_body_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link rel="preload" as="font" href="{{ settings.type_body_font | font_url }}" type="font/woff2" crossorigin>
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}
    {%- unless settings.type_header_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link rel="preload" as="font" href="{{ settings.type_header_font | font_url }}" type="font/woff2" crossorigin>
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}

    {%- if localization.available_countries.size > 1 or localization.available_languages.size > 1 -%}
      {{ 'component-localization-form.css' | asset_url | stylesheet_tag: preload: true }}
      <script src="{{ 'localization-form.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.predictive_search_enabled -%}
      <link
        rel="stylesheet"
        href="{{ 'component-predictive-search.css' | asset_url }}"
        media="print"
        onload="this.media='all'"
      >
    {%- endif -%}
    {% if template contains 'index' %}
      {{ 'home.css' | asset_url | stylesheet_tag }}
    {% endif %}
    <script>
      if (Shopify.designMode) {
        document.documentElement.classList.add('shopify-design-mode');
      }
    </script>
    <!-- Define the shipRocketMarketingLogin function -->
    <script>
      function shipRocketMarketingLogin() {
        // Redirect to the login page
        window.location.href = '/account/login';
      }
      function accountLogin(event) {
        event.preventDefault();
        if (typeof shipRocketMarketingLogin === 'function') {
          shipRocketMarketingLogin();
        } else {
          console.warn('shipRocketMarketingLogin function is not defined.');
          window.location.href = '/account/login';
        }
      }
    </script>

    {% render 'head-script' %}
    {% comment %}
      removed caused unused
      {{ 'pop-coin.css' | asset_url | stylesheet_tag }}
    {% endcomment %}
    {% if template.name == 'collection' or template.name == 'product' %}
      {{ 'pop-coin.css' | asset_url | stylesheet_tag }}
    {% endif %}
    {% render 'sr-checkout' %}
    <script defer>
      !(function () {
        var a = 'https://atc.anveshan.farm/api/track/',
          s = sessionStorage.getItem('_s') || 's' + Math.random().toString(36).substr(2, 9);
        sessionStorage.setItem('_s', s);
        function p() {
          var l = location.pathname;
          return '/' === l
            ? 'home'
            : l.indexOf('/products/') > -1
            ? 'product'
            : l.indexOf('/collections/') > -1
            ? 'collection'
            : l.indexOf('/cart') > -1
            ? 'cart'
            : 'other';
        }
        function c() {
          return (location.pathname.match(/\/collections\/([^\/\?]+)/) || [])[1] || '';
        }
        function b(e, d) {
          d._s = s;
          navigator.sendBeacon && navigator.sendBeacon(a + e, new Blob([JSON.stringify(d)], { type: 'text/plain' }));
        }
        var f = window.fetch;
        window.fetch = function () {
          var u = arguments[0],
            o = arguments[1] || {};
          if ('string' == typeof u && u.indexOf('/cart/add') > -1) {
            var r = f.apply(this, arguments);
            return (
              r.then(function (x) {
                x.ok &&
                  x
                    .clone()
                    .json()
                    .then(function (j) {
                      var g = p(),
                        h = c();
                      (j.items || [j]).forEach(function (i) {
                        i.product_id &&
                          b('atc', {
                            product_id: String(i.product_id),
                            product_title: i.product_title || '',
                            product_handle: i.handle || '',
                            variant_id: String(i.variant_id || ''),
                            variant_title: i.variant_title || '',
                            price: (i.price || 0) / 100,
                            quantity: i.quantity || 1,
                            currency: 'INR',
                            collection_handle: h,
                            source_page_type: g,
                            source_url: location.href,
                            referrer: document.referrer,
                          });
                      });
                    })
                    .catch(function () {});
              }),
              r
            );
          }
          return f.apply(this, arguments);
        };
        window.addEventListener('load', function () {
          b('pageview', {
            page_type: p(),
            page_handle: (location.pathname.match(/\/(products|collections)\/([^\/\?]+)/) || [])[2] || '',
            source_url: location.href,
            referrer: document.referrer,
          });
        });
      })();
    </script>
  </head>
  <body
    class="gradient{% if settings.animations_hover_elements != 'none' %} animate--hover-{{ settings.animations_hover_elements }}{% endif %}{% if 'index, collection, page, product' contains template.name %} {{ template.name }}{% endif %}{%- if template.name == 'collection' %} collect-popcoin{% endif %}"
    id="themebody"
  >
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-5S9DFFD"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <a class="skip-to-content-link button visually-hidden" href="#MainContent">
      {{ 'accessibility.skip_to_text' | t }}
    </a>

    {% sections 'group-header' %}
    {% comment %} {% render 'kwikpass-add-button' %} {% endcomment %}
    <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    {% sections 'group-footer' %}
    {%- section 'sticky-rewards-bar' -%}

    {%- if settings.cart_type == 'drawer' or settings.cart_type == 'notification' -%}
      {%- section 'cart-drawer' -%}
    {%- endif -%}

    {% comment %} Cross-Sell Modal - Shows after Add to Cart on PDP {% endcomment %}
    {% render 'cross-sell-modal' %}

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
      <li id="a11y-new-window-message">{{ 'accessibility.link_messages.new_window' | t }}</li>
    </ul>

    <script>
      window.shopUrl = '{{ request.origin }}';
      window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        cart_url: '{{ routes.cart_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}',
      };

      window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`,
      };

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
        unavailable_with_option: `{{ 'products.product.value_unavailable' | t: option_value: '[value]' }}`,
      };

      window.quickOrderListStrings = {
        itemsAdded: `{{ 'sections.quick_order_list.items_added.other' | t: quantity: '[quantity]' }}`,
        itemAdded: `{{ 'sections.quick_order_list.items_added.one' | t: quantity: '[quantity]' }}`,
        itemsRemoved: `{{ 'sections.quick_order_list.items_removed.other' | t: quantity: '[quantity]' }}`,
        itemRemoved: `{{ 'sections.quick_order_list.items_removed.one' | t: quantity: '[quantity]' }}`,
        viewCart: `{{- 'sections.quick_order_list.view_cart' | t -}}`,
        each: `{{- 'sections.quick_order_list.each' | t: money: '[money]' }}`,
        min_error: `{{- 'sections.quick_order_list.min_error' | t: min: '[min]' }}`,
        max_error: `{{- 'sections.quick_order_list.max_error' | t: max: '[max]' }}`,
        step_error: `{{- 'sections.quick_order_list.step_error' | t: step: '[step]' }}`,
      };

      window.accessibilityStrings = {
        imageAvailable: `{{ 'products.product.media.image_available' | t: index: '[index]' }}`,
        shareSuccess: `{{ 'general.share.success_message' | t }}`,
        pauseSlideshow: `{{ 'sections.slideshow.pause_slideshow' | t }}`,
        playSlideshow: `{{ 'sections.slideshow.play_slideshow' | t }}`,
        recipientFormExpanded: `{{ 'recipient.form.expanded' | t }}`,
        recipientFormCollapsed: `{{ 'recipient.form.collapsed' | t }}`,
        countrySelectorSearchCount: `{{ 'localization.country_results_count' | t: count: '[count]' }}`,
      };
    </script>

    {%- if settings.predictive_search_enabled -%}
      <script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.cart_type == 'drawer' or settings.cart_type == 'notification' -%}
      <script src="{{ 'cart-drawer-custom.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    <script src="{{ 'search-placeholder-animation.js' | asset_url }}" defer></script>
    <style>
      .search__input {
        flex-grow: 1;
        text-align: left;
        padding: 1.5rem;
        margin: var(--inputs-border-width);
        transition: box-shadow var(--duration-short) ease;
        border: 0;
      }
      .search__button.field__button {
        background-color: #fff !important;
      }
    </style>
    {% render 'popup-alert' %}

    {% comment %} RV tracker - External file {% endcomment %}
    {% if template contains 'product' %}
      <script>
        window.RV_CONFIG = {
          API_URL: 'https://recently-viewed.anveshan.farm/api/recently-viewed',
          API_KEY: '2c4010dffce0f7dd1ab3a429acd5d334c94ec2ee7a0e3f8d9f06c9b41afd8f6a',
          DEBUG: false
        };
        window.RV_PRODUCT_DATA = {
          id: '{{ product.id }}',
          handle: '{{ product.handle }}',
          title: {{ product.title | json }},
          url: '{{ product.url }}',
          image: '{{ product.featured_image | image_url: width: 300 }}',
          price: '{{ product.price | money }}',
          variants: {{ product.variants | json }}
        };
        {% if customer %}window.RV_CUSTOMER_ID = '{{ customer.id }}';{% endif %}
      </script>
      <script src="{{ 'recently-viewed-tracker.js' | asset_url }}" defer></script>
    {% endif %}

    {% comment %} Customer RV sync - uses same config as tracker {% endcomment %}
    {% if customer %}
      <script>
        (function () {
          const API_URL = 'https://recently-viewed.anveshan.farm/api/recently-viewed';
          const API_KEY = '2c4010dffce0f7dd1ab3a429acd5d334c94ec2ee7a0e3f8d9f06c9b41afd8f6a';
          async function loadFromServer() {
            try {
              const response = await fetch(`${API_URL}/{{ customer.id }}`, {
                headers: { 'x-api-key': API_KEY },
              });
              if (!response.ok) return;
              const result = await response.json();
              if (result.success && result.data.products && result.data.products.length > 0) {
                let local = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                result.data.products.forEach((serverItem) => {
                  const exists = local.find(
                    (p) =>
                      (serverItem.variant_id && p.variant_id === serverItem.variant_id) ||
                      (!serverItem.variant_id && p.product_id === serverItem.product_id)
                  );
                  if (!exists) local.push(serverItem);
                });
                local = local.slice(0, 20);
                localStorage.setItem('recentlyViewed', JSON.stringify(local));
                if (window.updateRecentlyViewed) window.updateRecentlyViewed();
              }
            } catch (e) {}
          }
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadFromServer);
          } else {
            loadFromServer();
          }
        })();
      </script>
    {% endif %}
    {% comment %} WhatsApp Widget {% endcomment %}
    {% render 'whatsapp-widget' %}
    {% if template == 'index' or template.name == 'product' or template.name == 'collection' %}
      {% render 'variant-selector-modal' %}
    {% endif %}
    {% comment %} Qty Sold Badge - Real-time sales count from FBT API {% endcomment %}
    <script src="{{ 'qty-sold-badge.js' | asset_url }}" defer></script>
  </body>
</html>
