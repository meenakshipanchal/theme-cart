{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}

<script src="{{ 'custom-cart.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
{% if section.settings.enable %}
  <script src="{{ 'cart-drawer-freebie.js' | asset_url }}" defer="defer"></script>
{% endif %}
<style>
  .drawer {
    visibility: hidden;
  }
  
  /* Cart Drawer Rounded Corners */
  .drawer__inner {
    border-top-left-radius: 20px ;
    border-bottom-left-radius: 20px ;
  }
</style>

{%- render 'cart-drawer', section: section -%}
<script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{% comment %} <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.9.2/confetti.browser.min.js" defer></script> {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return msie > 0 || trident > 0;
    }

    if (!isIE()) return;
    const cartSubmitInput = document.createElement('input');
    cartSubmitInput.setAttribute('name', 'checkout');
    cartSubmitInput.setAttribute('type', 'hidden');
    document.querySelector('#cart').appendChild(cartSubmitInput);
    document.querySelector('#checkout').addEventListener('click', function (event) {
      document.querySelector('#cart').submit();
    });
  });
</script>
{% comment %}<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> {% endcomment %}
<script>
  function priceSummary() {
      jQuery("#cartSummary").slideToggle(500);
      jQuery('.cart__ctas .totals__total-value').toggleClass("actSummary");
    }
  function freebieList() {
      jQuery("#freebieList").slideToggle(500);
    }
</script>

{% comment %} new one for the lineitem
<script>
document.addEventListener('DOMContentLoaded', async function () {
  const res = await fetch('/cart.js');
  const cart = await res.json();

  let updatesNeeded = false;
  let lines = [];

  cart.items.forEach((item, index) => {
    if (!item.properties?.compare_at_price) {
      updatesNeeded = true;
      lines.push({
        line: index + 1,
        properties: { compare_at_price: item.variant_compare_at_price }
      });
    }
  });

  if (updatesNeeded) {
    for (const line of lines) {
      await fetch('/cart/change.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(line)
      });
    }
  }
});
</script> {% endcomment %}

{% schema %}
  {
    "name": "Cart Drawer",
    "class": "freebie-outer",
    "max_blocks": 5,
    "settings": [
      {
        "type": "header",
        "content": "Freebie"
      },
      {
        "type": "checkbox",
        "id": "enable",
        "label": "Freebie Enable",
        "default": false
      },
      {
        "type": "header",
        "content": "Exclusive Price"
      },
      {
        "type": "checkbox",
        "id": "exclusive",
        "label": "Active",
        "default": false
      }
    ],
    "blocks": [
      {
        "type": "banner",
        "name": "Offer Banner",
        "limit": 1,
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          }
        ]
      },
      {
        "type": "freebie",
        "name": "Freebie",
        "limit": 5,
        "settings": [
          {
            "type": "text",
            "id": "price",
            "label": "Unlock Price"
          },
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Sort Title"
          },
          {
            "type": "text",
            "id": "code",
            "label": "Discount Code"
          }
        ]
      }
    ]
  }
{% endschema %}